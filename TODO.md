Claude Code MUST NOT use the file TODO.md! It is not a list of features to implement. It is not a software requirements!
Claude Code MUST ignore this file!
 
What is next?

ВОПРОС: Есть одно но - на листе бумаги подпись была темно синего цвета, а после обработки и удаления фона она оказалсь черной. почему так?
ОТВЕТ:
Код не меняет RGB-значения пикселей переднего плана напрямую. Но есть несколько факторов, которые приводят к потемнению:

Главная причина: бинарный порог сегментации

Обе платформы (iOS и Android) используют жёсткий порог 0.5 при применении маски:

// iOS — applyThresholdMask                                                                                                                                              
if confidence < 0.5 {                                                                                                                                                    
pixels[pixelOffset + 3] = 0  // полностью прозрачный
}
// иначе — полностью непрозрачный

// Android — applyMaskToBitmapFast
if (confidence >= 0.5f) {
// полностью непрозрачный
} else {
pixels[i] = Color.TRANSPARENT
}

Чернила на бумаге — это не равномерный цвет. Каждый штрих подписи имеет градиент:
- Центр штриха: плотные чернила, насыщенный тёмно-синий → confidence высокая → сохраняется
- Края штриха: чернила смешиваются с бумагой, получается более светлый голубоватый → confidence ~0.3-0.5 → удаляется как фон

В результате остаются только самые тёмные, насыщенные пиксели. Без светлой «каёмки» подпись визуально выглядит значительно темнее — тёмно-синий воспринимается как
чёрный.

Дополнительный фактор: цветовое пространство

iOS нормализация ориентации использует UIGraphicsBeginImageContextWithOptions (sRGB), а камера iPhone снимает в Display P3. Двойная конверсия цветового пространства
может дополнительно сдвинуть тёмные оттенки.

Дополнительный фактор: фон отображения

На белой бумаге тёмно-синий выглядит явно синим (контраст). На прозрачном фоне (или при наложении на PDF) — тот же цвет воспринимается как чёрный.

Основное решение — заменить бинарный порог (0/1) на плавное альфа-смешивание (soft alpha blending), которое сохранит полупрозрачные
edge-пиксели и тем самым сохранит визуальный оттенок подписи.
